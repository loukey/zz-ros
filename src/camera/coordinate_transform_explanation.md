# æ‰‹çœ¼æ ‡å®šåæ ‡ç³»å˜æ¢è¯¦è§£

## ğŸ¯ æ ¸å¿ƒé—®é¢˜

ç”¨æˆ·æå‡ºçš„é—®é¢˜éå¸¸é‡è¦ï¼š"ç›¸æœºä½å§¿æ˜¯ç›¸å¯¹äºæ ‡å®šæ¿çš„ï¼Œæœ«ç«¯æ‰§è¡Œå™¨ä½å§¿æ˜¯ç›¸å¯¹äºåŸºåº§çš„ï¼Œè¿™æ ·èƒ½ç›´æ¥è½¬æ¢å—ï¼Ÿ"

**ç­”æ¡ˆï¼šä¸èƒ½ç›´æ¥è½¬æ¢ï¼éœ€è¦æ­£ç¡®ç†è§£åæ ‡ç³»å…³ç³»å’Œæ•°å­¦å…¬å¼ã€‚**

## ğŸ“ åæ ‡ç³»å®šä¹‰

### Eye-in-Hand é…ç½®ä¸‹çš„åæ ‡ç³»ï¼š

```
Base (æœºå™¨äººåŸºåº§) â†’ Gripper (æœ«ç«¯æ‰§è¡Œå™¨) â†’ Camera (ç›¸æœº) â†’ Board (æ ‡å®šæ¿)
      T_b2g                    T_g2c              T_c2b
```

- **Base**: æœºå™¨äººåŸºåº§åæ ‡ç³» (å›ºå®šå‚è€ƒç³»)
- **Gripper**: æœºå™¨äººæœ«ç«¯æ‰§è¡Œå™¨åæ ‡ç³» (è¿åŠ¨)
- **Camera**: ç›¸æœºåæ ‡ç³» (å›ºå®šåœ¨æœ«ç«¯æ‰§è¡Œå™¨ä¸Š)
- **Board**: æ ‡å®šæ¿åæ ‡ç³» (ä¸–ç•Œåæ ‡ç³»)

## ğŸ”„ å˜æ¢å…³ç³»

### 1. æœºå™¨äººä½å§¿
```python
T_base_to_gripper = robot.get_current_pose()  # æœºå™¨äººæ­£è¿åŠ¨å­¦
```
- è¡¨ç¤ºï¼šä»åŸºåº§åæ ‡ç³»åˆ°æœ«ç«¯æ‰§è¡Œå™¨åæ ‡ç³»çš„å˜æ¢
- æ¥æºï¼šæœºå™¨äººæ§åˆ¶å™¨/æ­£è¿åŠ¨å­¦è®¡ç®—
- ç‰¹ç‚¹ï¼šæ¯ä¸ªä½å§¿éƒ½ä¸åŒ

### 2. ç›¸æœºè§‚å¯Ÿä½å§¿
```python
T_camera_to_board = cv2.solvePnP(...)  # PnPç®—æ³•
```
- è¡¨ç¤ºï¼šä»ç›¸æœºåæ ‡ç³»åˆ°æ ‡å®šæ¿åæ ‡ç³»çš„å˜æ¢
- æ¥æºï¼šå›¾åƒå¤„ç†/PnPç®—æ³•
- ç‰¹ç‚¹ï¼šæ¯ä¸ªä½å§¿éƒ½ä¸åŒ

### 3. æ‰‹çœ¼å˜æ¢ï¼ˆè¦æ±‚è§£çš„ï¼‰
```python
T_gripper_to_camera = ?  # æ‰‹çœ¼æ ‡å®šçš„ç›®æ ‡
```
- è¡¨ç¤ºï¼šä»æœ«ç«¯æ‰§è¡Œå™¨åˆ°ç›¸æœºçš„å›ºå®šå˜æ¢
- æ¥æºï¼šæ‰‹çœ¼æ ‡å®šç®—æ³•æ±‚è§£
- ç‰¹ç‚¹ï¼šç‰©ç†å›ºå®šï¼Œä¸éšä½å§¿å˜åŒ–

## ğŸ§® æ•°å­¦å…¬å¼

### Eye-in-Hand æ‰‹çœ¼æ ‡å®šæ–¹ç¨‹ï¼š
```
A_i * X = X * B_i
```

å…¶ä¸­ï¼š
- **A_i**: æœ«ç«¯æ‰§è¡Œå™¨åœ¨ä½å§¿iå’Œä½å§¿jä¹‹é—´çš„ç›¸å¯¹å˜æ¢
- **B_i**: æ ‡å®šæ¿åœ¨ç›¸æœºä¸­çš„ç›¸å¯¹å˜æ¢
- **X**: è¦æ±‚è§£çš„æ‰‹çœ¼å˜æ¢ T_gripper_to_camera

### ç›¸å¯¹å˜æ¢è®¡ç®—ï¼š
```python
# æœ«ç«¯æ‰§è¡Œå™¨ç›¸å¯¹å˜æ¢
A_i = T_gripper_j * inv(T_gripper_i)

# ç›¸æœºè§‚å¯Ÿçš„ç›¸å¯¹å˜æ¢  
B_i = T_board_j_in_cam * inv(T_board_i_in_cam)
```

## âš ï¸ å¸¸è§é”™è¯¯

### é”™è¯¯1ï¼šåæ ‡ç³»æ–¹å‘æå
```python
# âŒ é”™è¯¯ï¼šç›´æ¥ä½¿ç”¨åŸå§‹æ•°æ®
robot_pose = T_base_to_gripper      # åŸºåº§åˆ°æœ«ç«¯æ‰§è¡Œå™¨
camera_pose = T_camera_to_board     # ç›¸æœºåˆ°æ ‡å®šæ¿

# âœ… æ­£ç¡®ï¼šè½¬æ¢ä¸ºOpenCVæœŸæœ›çš„æ–¹å‘
gripper_to_base = inv(T_base_to_gripper)  # æœ«ç«¯æ‰§è¡Œå™¨åˆ°åŸºåº§
board_to_camera = inv(T_camera_to_board)  # æ ‡å®šæ¿åˆ°ç›¸æœº
```

### é”™è¯¯2ï¼šæ··æ·†ç»å¯¹ä½å§¿å’Œç›¸å¯¹ä½å§¿
```python
# âŒ é”™è¯¯ï¼šç›´æ¥ç”¨ç»å¯¹ä½å§¿åšæ ‡å®š
calibrateHandEye(absolute_poses, ...)

# âœ… æ­£ç¡®ï¼šOpenCVå†…éƒ¨ä¼šè®¡ç®—ç›¸å¯¹å˜æ¢
# æˆ‘ä»¬æä¾›æ­£ç¡®æ–¹å‘çš„ç»å¯¹ä½å§¿å³å¯
```

## ğŸ”§ ä»£ç ä¿®æ­£

### ä¿®æ­£å‰ï¼š
```python
# æœºå™¨äººä½å§¿ (åŸºåº§åˆ°æœ«ç«¯æ‰§è¡Œå™¨) - æ–¹å‘é”™è¯¯ï¼
R_gripper2base.append(robot_pose[:3, :3])
t_gripper2base.append(robot_pose[:3, 3])

# ç›¸æœºè§‚å¯Ÿåˆ°çš„æ ‡å®šæ¿ä½å§¿ (ç›¸æœºåˆ°æ ‡å®šæ¿) - æ–¹å‘é”™è¯¯ï¼
R_target2cam.append(camera_pose[:3, :3])
t_target2cam.append(camera_pose[:3, 3])
```

### ä¿®æ­£åï¼š
```python
# æœºå™¨äººä½å§¿è½¬æ¢ï¼šä» T_base_to_gripper è½¬ä¸º T_gripper_to_base
T_base_to_gripper = robot_pose
T_gripper_to_base = np.linalg.inv(T_base_to_gripper)
R_gripper2base.append(T_gripper_to_base[:3, :3])
t_gripper2base.append(T_gripper_to_base[:3, 3])

# ç›¸æœºä½å§¿è½¬æ¢ï¼šä» T_cam_to_board è½¬ä¸º T_board_to_cam
T_cam_to_board = camera_pose
T_board_to_cam = np.linalg.inv(T_cam_to_board)
R_target2cam.append(T_board_to_cam[:3, :3])
t_target2cam.append(T_board_to_cam[:3, 3])
```

## ğŸ¯ éªŒè¯æ–¹æ³•

æ ‡å®šå®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ï¼š

```python
# 1. è®¡ç®—ç›¸æœºåœ¨åŸºåº§åæ ‡ç³»ä¸­çš„ä½å§¿
T_base_to_camera = T_base_to_gripper @ T_gripper_to_camera

# 2. ä½¿ç”¨ç›¸æœºå†…å‚æŠ•å½±3Dç‚¹åˆ°å›¾åƒ
image_point = project_3d_to_image(world_point, T_base_to_camera, camera_matrix)

# 3. å¯¹æ¯”æŠ•å½±ç‚¹ä¸å®é™…æ£€æµ‹ç‚¹çš„è¯¯å·®
error = np.linalg.norm(image_point - detected_point)
```

## ğŸ“‹ æ€»ç»“

âœ… **å…³é”®ç‚¹**ï¼š
1. ç†è§£å„åæ ‡ç³»ä¹‹é—´çš„å˜æ¢å…³ç³»
2. æ³¨æ„å˜æ¢çŸ©é˜µçš„æ–¹å‘ï¼ˆAåˆ°B vs Båˆ°Aï¼‰
3. OpenCVæœŸæœ›ç‰¹å®šæ–¹å‘çš„è¾“å…¥
4. ç›¸å¯¹å˜æ¢vsç»å¯¹ä½å§¿çš„åŒºåˆ«

âœ… **éªŒè¯æ ‡å‡†**ï¼š
- é‡æŠ•å½±è¯¯å·® < 5 åƒç´ 
- ä½ç½®è¯¯å·® < 5mm
- è§’åº¦è¯¯å·® < 2Â°

âš ï¸ **å¸¸è§é™·é˜±**ï¼š
1. åæ ‡ç³»æ–¹å‘æå
2. æ··æ·†ç»å¯¹ä½å§¿å’Œç›¸å¯¹å˜æ¢
3. å¿½ç•¥æ ‡å®šæ¿å’Œç›¸æœºçš„ä½ç½®å…³ç³»
4. æ•°æ®æ”¶é›†æ—¶è¿åŠ¨èŒƒå›´ä¸å¤Ÿ

é€šè¿‡æ­£ç¡®ç†è§£è¿™äº›æ•°å­¦å…³ç³»ï¼Œæ‰èƒ½å®ç°å‡†ç¡®çš„æ‰‹çœ¼æ ‡å®šï¼ 